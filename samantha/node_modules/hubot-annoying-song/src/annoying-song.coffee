# Description:
#   Sing an annoying song.  I'd suggest only using this for debug purposes.
#
# Commands:
#   sing <song> - sing the song specified
#   sing - sing a random song
#   stop - makes the singing stop
#
# Author:
#   Andrew Lucas <andrewl@resin.io> <sqweelygig@gmail.com>

module.exports = (robot) ->

  interval = null
  song = null
  line = 0
  songs = {
    'titanic': [
      'Every night in my dreams',
      'I see you, I feel you,',
      'That is how I know you go on',
      'Far across the distance',
      'And spaces between us',
      'You have come to show you go on',
      'Near, far, wherever you are',
      'I believe that the heart does go on',
      'Once more you open the door',
      "And you're here in my heart",
      'And my heart will go on and on'
    ]
  }

  robot.hear /sing\b/i, (res) ->
    clearInterval interval
    line = 0
    potential_songs = []
    for word in res.message.text.split /\W+/
      if songs.hasOwnProperty word
        potential_songs.push word
    if potential_songs.length is 0
      potential_songs = Object.keys songs
    song = res.random potential_songs
    res.send "Hmmm, I'll sing you the song of " + song + '!'
    interval = setInterval ->
      res.send songs[song][line]
      line++
      if line >= songs[song].length
        clearInterval interval
    , 2000

  robot.hear /stop singing/i, (res) ->
    clearInterval(interval)
    res.send "Okay okay, as if you can sing better :-p..."

